---
- name: setup ufw
  ufw: state=enabled policy=deny

- name: allow ssh traffic
  ufw: rule=allow port={{ SSH_PORT }} proto=tcp

- name: change ssh port
  lineinfile: dest=/etc/ssh/sshd_config
              regexp="^Port\s"
              line="Port {{ SSH_PORT }}"
              state=present
  notify: restart ssh

- name: disallow password authentication
  lineinfile: dest=/etc/ssh/sshd_config
              regexp="^PasswordAuthentication"
              line="PasswordAuthentication no"
              state=present
  notify: restart ssh

- name: disallow root SSH access
  lineinfile: dest=/etc/ssh/sshd_config
              regexp="^PermitRootLogin"
              line="PermitRootLogin no"
              state=present
  notify: restart ssh